<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>六獸 AI 分析系統</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body class="min-h-screen bg-gradient-to-br from-pink-50 to-purple-50 text-gray-800 transition-colors duration-300">

  <div class="max-w-5xl mx-auto p-6">
    <h1 class="text-3xl font-bold text-center text-purple-700 mb-6">六獸 AI 分析系統</h1>

    <!-- 顏色控制 -->
    <div class="flex gap-6 mb-6 flex-wrap">
      <div>
        <label class="block text-sm font-medium">雷達圖顏色</label>
        <select id="colorSelect" class="mt-1 p-2 border rounded">
          <option value="rgba(255,99,132,0.5)">紅色</option>
          <option value="rgba(54,162,235,0.5)">藍色</option>
          <option value="rgba(75,192,192,0.5)">綠色</option>
          <option value="rgba(255,206,86,0.5)">黃色</option>
          <option value="rgba(153,102,255,0.5)">紫色</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium">背景顏色</label>
        <input type="color" id="bgPicker" value="#fff0f5" class="mt-1 h-10 w-20 border rounded">
      </div>
    </div>

    <!-- 分析按鈕 -->
    <div class="flex gap-4 mb-6 flex-wrap">
      <button onclick="analyze('職場')" class="px-4 py-2 bg-blue-500 text-white rounded">職場分析</button>
      <button onclick="analyze('愛情')" class="px-4 py-2 bg-pink-500 text-white rounded">愛情分析</button>
      <button onclick="analyze('性愛')" class="px-4 py-2 bg-red-500 text-white rounded">性愛分析</button>
      <button onclick="analyze('個性')" class="px-4 py-2 bg-purple-600 text-white rounded">個性分析</button>
    </div>

    <!-- 分析內容 -->
    <div id="analysisResult" class="bg-white shadow rounded p-6 mb-6 min-h-[200px]"></div>

    <!-- 雷達圖 -->
    <div class="bg-white shadow rounded p-6">
      <canvas id="radarChart"></canvas>
    </div>

    <!-- 列印 -->
    <div class="mt-6 text-center">
      <button onclick="window.print()" class="px-6 py-2 bg-green-600 text-white rounded shadow">列印結果</button>
    </div>
  </div>

  <script>
    // 預設雷達圖
    const ctx = document.getElementById('radarChart').getContext('2d');
    const radarChart = new Chart(ctx, {
      type: 'radar',
      data: {
        labels: ["情感", "事業", "健康", "財運", "智慧"],
        datasets: [{
          label: "能量分布",
          data: [5, 5, 5, 5, 5],
          backgroundColor: "rgba(255,99,132,0.5)",
          borderColor: "rgba(255,99,132,1)",
          borderWidth: 2
        }]
      },
      options: {
        responsive: true,
        animation: { duration: 1500, easing: "easeOutQuart" },
        scales: {
          r: { min: 0, max: 10, ticks: { stepSize: 1 } }
        }
      }
    });

    // 改雷達圖顏色
    document.getElementById("colorSelect").addEventListener("change", (e) => {
      const color = e.target.value;
      radarChart.data.datasets[0].backgroundColor = color;
      radarChart.data.datasets[0].borderColor = color.replace("0.5", "1");
      radarChart.update();
    });

    // 改背景顏色
    document.getElementById("bgPicker").addEventListener("input", (e) => {
      document.body.style.background = e.target.value;
    });

    // 呼叫 API
    async function analyze(type) {
      document.getElementById("analysisResult").innerHTML = `<p class="text-gray-500">分析中...請稍候</p>`;
      
      const response = await fetch("/api/analyze", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ context: type })
      });
      const data = await response.json();

      document.getElementById("analysisResult").innerHTML = data.text;

      // 更新雷達圖數據
      radarChart.data.datasets[0].data = [
        data.scores["情感"],
        data.scores["事業"],
        data.scores["健康"],
        data.scores["財運"],
        data.scores["智慧"]
      ];
      radarChart.update();
    }
  </script>
</body>
</html>
